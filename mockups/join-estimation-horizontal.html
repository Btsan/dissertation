<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Join Estimation - Horizontal Flow Variations</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			padding: 40px;
			background: #f5f5f5;
		}
		.variation {
			background: white;
			padding: 30px;
			margin-bottom: 50px;
			border-radius: 8px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}
		.variation h2 {
			color: #667eea;
			border-bottom: 3px solid #667eea;
			padding-bottom: 10px;
			margin-top: 0;
		}

		/* Query boxes */
		.query-box {
			background: #f8f9fa;
			border-left: 4px solid #667eea;
			padding: 15px;
			margin: 20px 0;
			border-radius: 4px;
		}
		.query-box .label {
			color: #667eea;
			font-weight: bold;
			margin-bottom: 8px;
			font-size: 0.85em;
			text-transform: uppercase;
		}
		.query-box pre {
			margin: 0;
			font-family: 'Courier New', monospace;
			font-size: 0.85em;
			color: #333;
			white-space: pre-wrap;
		}
		.filter-highlight {
			background: #fff3e0;
			padding: 2px 4px;
			border-radius: 2px;
		}
		.join-highlight {
			background: #e8f5e9;
			padding: 2px 4px;
			border-radius: 2px;
			font-weight: bold;
		}

		/* ================================================= */
		/* VARIATION 1: Compact Query in Flow */
		/* ================================================= */
		.horizontal-flow-1 {
			display: flex;
			align-items: center;
			gap: 15px;
			margin: 30px 0;
			justify-content: center;
		}
		.flow-box-1 {
			border: 2px solid #ddd;
			border-radius: 8px;
			padding: 15px;
			background: white;
			min-width: 140px;
		}
		.flow-box-1.query {
			background: #f8f9fa;
			border-color: #667eea;
			max-width: 180px;
		}
		.flow-box-1.model {
			background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
			border-color: #667eea;
			min-width: 160px;
		}
		.flow-box-1.sketch {
			background: #e8f5e9;
			border-color: #4caf50;
			min-width: 160px;
		}
		.flow-box-1.result {
			background: #e3f2fd;
			border-color: #2196f3;
			min-width: 140px;
		}
		.flow-box-1 .box-title {
			font-weight: bold;
			color: #667eea;
			margin-bottom: 10px;
			font-size: 0.85em;
			border-bottom: 1px solid #ddd;
			padding-bottom: 5px;
		}
		.flow-box-1 .box-content {
			font-size: 0.75em;
			font-family: 'Courier New', monospace;
			line-height: 1.4;
		}
		.flow-box-1.query .box-content {
			font-size: 0.7em;
		}
		.arrow-h {
			font-size: 2em;
			color: #667eea;
			font-weight: bold;
		}
		.flow-divider {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 15px;
		}
		.flow-divider .connector {
			font-size: 1.5em;
			color: #667eea;
		}

		/* ================================================= */
		/* VARIATION 2: Query at Top */
		/* ================================================= */
		.horizontal-flow-2 {
			display: flex;
			align-items: center;
			gap: 20px;
			margin: 30px 0;
			justify-content: center;
		}
		.flow-box-2 {
			border: 2px solid #ddd;
			border-radius: 8px;
			padding: 18px;
			background: white;
			min-width: 160px;
		}
		.flow-box-2.model {
			background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
			border-color: #667eea;
		}
		.flow-box-2.sketch {
			background: #e8f5e9;
			border-color: #4caf50;
		}
		.flow-box-2.result {
			background: #e3f2fd;
			border-color: #2196f3;
			min-width: 180px;
		}
		.flow-box-2 .box-title {
			font-weight: bold;
			color: #667eea;
			margin-bottom: 12px;
			font-size: 0.9em;
			text-align: center;
		}
		.flow-box-2 .box-label {
			font-size: 0.75em;
			color: #666;
			margin-bottom: 6px;
			font-weight: bold;
		}
		.flow-box-2 .box-content {
			font-size: 0.8em;
			font-family: 'Courier New', monospace;
			line-height: 1.5;
		}
		.relation-group {
			display: flex;
			flex-direction: column;
			gap: 20px;
		}

		/* ================================================= */
		/* VARIATION 3: Visual Pipeline with Sketch Bars */
		/* ================================================= */
		.horizontal-flow-3 {
			display: flex;
			align-items: center;
			gap: 20px;
			margin: 30px 0;
			justify-content: center;
		}
		.flow-box-3 {
			border: 2px solid #ddd;
			border-radius: 8px;
			padding: 18px;
			background: white;
		}
		.flow-box-3.input {
			background: #fff3e0;
			border-color: #ff9800;
			min-width: 140px;
		}
		.flow-box-3.model {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			min-width: 100px;
			text-align: center;
			font-weight: bold;
		}
		.flow-box-3.sketch {
			background: white;
			border-color: #4caf50;
			min-width: 160px;
		}
		.flow-box-3.join {
			background: #e3f2fd;
			border-color: #2196f3;
			min-width: 100px;
			text-align: center;
		}
		.flow-box-3 .box-title {
			font-weight: bold;
			margin-bottom: 10px;
			font-size: 0.85em;
		}
		.flow-box-3.input .box-title {
			color: #e65100;
		}
		.flow-box-3.sketch .box-title {
			color: #2e7d32;
		}
		.flow-box-3.join .box-title {
			color: #1565c0;
		}
		.flow-box-3 .box-content {
			font-size: 0.75em;
			font-family: 'Courier New', monospace;
			line-height: 1.5;
		}
		.flow-box-3.model .box-content {
			font-size: 0.7em;
			font-weight: normal;
		}
		.sketch-visual {
			display: flex;
			gap: 3px;
			margin-top: 8px;
			height: 40px;
			align-items: flex-end;
		}
		.sketch-bar {
			flex: 1;
			background: #4caf50;
			border-radius: 2px 2px 0 0;
			min-width: 8px;
		}
		.relation-pipeline {
			display: flex;
			flex-direction: column;
			gap: 20px;
		}
		.pipeline-row {
			display: flex;
			align-items: center;
			gap: 15px;
		}
		.relation-label {
			background: #667eea;
			color: white;
			padding: 8px 15px;
			border-radius: 6px;
			font-weight: bold;
			font-size: 0.85em;
			min-width: 90px;
			text-align: center;
		}
	</style>
</head>
<body>
	<h1 style="color: #667eea;">Join Estimation - Horizontal Flow Variations</h1>
	<p style="color: #666; margin-bottom: 40px;">Three different horizontal layouts for the compact flow diagram.</p>

	<!-- ============================================ -->
	<!-- VARIATION 1: Compact Query in Flow -->
	<!-- ============================================ -->
	<div class="variation">
		<h2>Variation 1: Compact Query Inline with Flow</h2>
		<p><strong>Concept:</strong> Query formatted compactly as first box in horizontal flow.</p>

		<div class="horizontal-flow-1">
			<!-- Query Box -->
			<div class="flow-box-1 query">
				<div class="box-title">Query</div>
				<div class="box-content">
					customers ⋈ orders<br>
					ON customer_id<br>
					<span style="background: #fff3e0; padding: 1px 3px;">WHERE</span><br>
					c.age=35<br>
					c.city='SF'<br>
					o.year=2023
				</div>
			</div>

			<span class="arrow-h">→</span>

			<!-- Models -->
			<div class="flow-divider">
				<div class="flow-box-1 model">
					<div class="box-title">BERT<sub>c</sub></div>
					<div class="box-content">
						[h(35),<br>
						 h('SF'),<br>
						 [MASK]]
					</div>
				</div>
				<div class="flow-box-1 model">
					<div class="box-title">BERT<sub>o</sub></div>
					<div class="box-content">
						[h([2023,2024)),<br>
						 [MASK]]
					</div>
				</div>
			</div>

			<span class="arrow-h">→</span>

			<!-- Sketches -->
			<div class="flow-divider">
				<div class="flow-box-1 sketch">
					<div class="box-title">Sketch<sub>c</sub></div>
					<div class="box-content">
						p<sub>c</sub> × |σ(c)|
					</div>
				</div>
				<div class="flow-box-1 sketch">
					<div class="box-title">Sketch<sub>o</sub></div>
					<div class="box-content">
						p<sub>o</sub> × |σ(o)|
					</div>
				</div>
			</div>

			<span class="arrow-h">→</span>

			<!-- Result -->
			<div class="flow-box-1 result">
				<div class="box-title">Join Size</div>
				<div class="box-content">
					S<sub>c</sub> · S<sub>o</sub>
				</div>
			</div>
		</div>

		<p style="color: #666; font-size: 0.9em; margin-top: 20px;">
			<strong>Pros:</strong> Everything in one horizontal flow, compact query format<br>
			<strong>Cons:</strong> Query box might be harder to read with multi-line format
		</p>
	</div>

	<!-- ============================================ -->
	<!-- VARIATION 2: Query at Top -->
	<!-- ============================================ -->
	<div class="variation">
		<h2>Variation 2: Query at Top, Horizontal Flow Below</h2>
		<p><strong>Concept:</strong> Full query displayed traditionally at top, clean horizontal flow below.</p>

		<div class="query-box">
			<div class="label">Join Query</div>
			<pre>SELECT COUNT(*)
FROM customers c JOIN orders o ON <span class="join-highlight">c.customer_id = o.customer_id</span>
WHERE <span class="filter-highlight">c.age = 35 AND c.city = 'SF'</span> AND <span class="filter-highlight">o.year = 2023</span></pre>
		</div>

		<div class="horizontal-flow-2">
			<!-- Customers Path -->
			<div class="relation-group">
				<div class="flow-box-2 model">
					<div class="box-title">BERT<sub>customers</sub></div>
					<div class="box-label">Input:</div>
					<div class="box-content">
						[h(35), h('SF'), [MASK]]
					</div>
				</div>
			</div>

			<span class="arrow-h">→</span>

			<div class="relation-group">
				<div class="flow-box-2 sketch">
					<div class="box-title">Sketch<sub>c</sub></div>
					<div class="box-content">
						p<sub>c</sub> × |σ(customers)|<br>
						= [0.15, 0.08, ...]
					</div>
				</div>
			</div>

			<span class="arrow-h">→</span>

			<!-- Join -->
			<div class="flow-box-2 result">
				<div class="box-title">Join Estimate</div>
				<div class="box-content" style="text-align: center; font-size: 0.9em;">
					S<sub>c</sub> · S<sub>o</sub>
				</div>
			</div>

			<span class="arrow-h">←</span>

			<!-- Orders Path -->
			<div class="relation-group">
				<div class="flow-box-2 sketch">
					<div class="box-title">Sketch<sub>o</sub></div>
					<div class="box-content">
						p<sub>o</sub> × |σ(orders)|<br>
						= [0.11, 0.14, ...]
					</div>
				</div>
			</div>

			<span class="arrow-h">←</span>

			<div class="relation-group">
				<div class="flow-box-2 model">
					<div class="box-title">BERT<sub>orders</sub></div>
					<div class="box-label">Input:</div>
					<div class="box-content">
						[h([2023,2024)), [MASK]]
					</div>
				</div>
			</div>
		</div>

		<p style="color: #666; font-size: 0.9em; margin-top: 20px;">
			<strong>Pros:</strong> Query easy to read at top, symmetric flow shows both paths converge<br>
			<strong>Cons:</strong> Bidirectional arrows might be confusing, takes more horizontal space
		</p>
	</div>

	<!-- ============================================ -->
	<!-- VARIATION 3: Visual Pipeline (Surprise!) -->
	<!-- ============================================ -->
	<div class="variation">
		<h2>Variation 3: Visual Pipeline with Sketch Bars (Surprise!)</h2>
		<p><strong>Concept:</strong> Show sketches as visual bar charts, emphasize per-relation processing.</p>

		<div class="query-box">
			<div class="label">Join Query</div>
			<pre>SELECT COUNT(*) FROM customers c JOIN orders o ON <span class="join-highlight">c.customer_id = o.customer_id</span>
WHERE <span class="filter-highlight">c.age = 35 AND c.city = 'SF' AND o.year = 2023</span></pre>
		</div>

		<div class="relation-pipeline">
			<!-- Customers Row -->
			<div class="pipeline-row">
				<div class="relation-label">customers</div>

				<div class="flow-box-3 input">
					<div class="box-title">Filters</div>
					<div class="box-content">
						age = 35<br>
						city = 'SF'
					</div>
				</div>

				<span class="arrow-h" style="font-size: 1.5em;">→</span>

				<div class="flow-box-3 model">
					BERT<sub>c</sub>
					<div class="box-content">[7, 12, [MASK]]</div>
				</div>

				<span class="arrow-h" style="font-size: 1.5em;">→</span>

				<div class="flow-box-3 sketch">
					<div class="box-title">S<sub>c</sub></div>
					<div class="sketch-visual">
						<div class="sketch-bar" style="height: 60%;"></div>
						<div class="sketch-bar" style="height: 35%;"></div>
						<div class="sketch-bar" style="height: 50%;"></div>
						<div class="sketch-bar" style="height: 40%;"></div>
						<div class="sketch-bar" style="height: 55%;"></div>
						<div class="sketch-bar" style="height: 45%;"></div>
					</div>
				</div>
			</div>

			<!-- Orders Row -->
			<div class="pipeline-row">
				<div class="relation-label">orders</div>

				<div class="flow-box-3 input">
					<div class="box-title">Filters</div>
					<div class="box-content">
						year = 2023
					</div>
				</div>

				<span class="arrow-h" style="font-size: 1.5em;">→</span>

				<div class="flow-box-3 model">
					BERT<sub>o</sub>
					<div class="box-content">[45, [MASK]]</div>
				</div>

				<span class="arrow-h" style="font-size: 1.5em;">→</span>

				<div class="flow-box-3 sketch">
					<div class="box-title">S<sub>o</sub></div>
					<div class="sketch-visual">
						<div class="sketch-bar" style="height: 45%;"></div>
						<div class="sketch-bar" style="height: 65%;"></div>
						<div class="sketch-bar" style="height: 40%;"></div>
						<div class="sketch-bar" style="height: 50%;"></div>
						<div class="sketch-bar" style="height: 55%;"></div>
						<div class="sketch-bar" style="height: 48%;"></div>
					</div>
				</div>
			</div>
		</div>

		<!-- Join Result -->
		<div style="display: flex; justify-content: center; margin-top: 30px;">
			<div class="flow-box-3 join" style="min-width: 250px;">
				<div class="box-title">Join Cardinality Estimate</div>
				<div class="box-content" style="text-align: center; font-size: 1em; margin-top: 10px;">
					|customers ⋈ orders| ≈ S<sub>c</sub> · S<sub>o</sub>
				</div>
				<div style="margin-top: 10px; font-size: 0.75em; color: #666; text-align: center;">
					Dot product of sketch vectors
				</div>
			</div>
		</div>

		<p style="color: #666; font-size: 0.9em; margin-top: 20px;">
			<strong>Pros:</strong> Visual sketch representation, clearly shows per-relation processing, symmetric rows<br>
			<strong>Cons:</strong> Takes more vertical space, sketch bars are illustrative only (not real values)<br>
			<strong>Bonus:</strong> Looks like a data pipeline / query plan that database people will recognize!
		</p>
	</div>

	<!-- ============================================ -->
	<!-- SUMMARY -->
	<!-- ============================================ -->
	<div class="variation" style="background: #f0f0f0;">
		<h2>Summary & Recommendations</h2>

		<h3>Comparison:</h3>
		<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
			<tr style="background: #667eea; color: white;">
				<th style="padding: 10px; border: 1px solid #333;">Variation</th>
				<th style="padding: 10px; border: 1px solid #333;">Layout</th>
				<th style="padding: 10px; border: 1px solid #333;">Best For</th>
			</tr>
			<tr>
				<td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">1. Compact Query Inline</td>
				<td style="padding: 10px; border: 1px solid #ddd;">Single horizontal flow</td>
				<td style="padding: 10px; border: 1px solid #ddd;">Maximizing horizontal space usage, showing everything in one line</td>
			</tr>
			<tr style="background: #f9f9f9;">
				<td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">2. Query at Top</td>
				<td style="padding: 10px; border: 1px solid #ddd;">Traditional query + symmetric flow</td>
				<td style="padding: 10px; border: 1px solid #ddd;">Query readability, showing convergence pattern</td>
			</tr>
			<tr>
				<td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">3. Visual Pipeline</td>
				<td style="padding: 10px; border: 1px solid #ddd;">Two parallel rows + join below</td>
				<td style="padding: 10px; border: 1px solid #ddd;">Visual impact, showing per-relation independence, sketch visualization</td>
			</tr>
		</table>

		<h3>Recommendations:</h3>
		<ul>
			<li><strong>For standard presentation:</strong> Variation 2 (Query at Top) - familiar format, easy to follow</li>
			<li><strong>For maximum clarity:</strong> Variation 3 (Visual Pipeline) - shows process structure clearly</li>
			<li><strong>For space constraints:</strong> Variation 1 (Compact Inline) - most horizontal</li>
		</ul>

		<h3>Why Variation 3 is the "Surprise":</h3>
		<ul>
			<li>✨ <strong>Visual sketch representation</strong> - shows sketches as bar charts instead of just text</li>
			<li>✨ <strong>Per-relation emphasis</strong> - each relation gets its own row, showing independence</li>
			<li>✨ <strong>Pipeline aesthetic</strong> - looks like a query execution plan diagram</li>
			<li>✨ <strong>Symmetric and balanced</strong> - easier to see both paths are equivalent</li>
			<li>✨ <strong>Professional visualization</strong> - goes beyond simple boxes and arrows</li>
		</ul>
	</div>

</body>
</html>
